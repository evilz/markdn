<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">Markdn.Blazor.App</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Home
            </NavLink>
        </div>

        @foreach (var r in Routes)
            {
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="@r.Route">
                        <span class="bi bi-file-earmark-text-fill-nav-menu" aria-hidden="true"></span> @r.Name
                    </NavLink>
                </div>
            }
        }

    </nav>

@code {
    private List<(string Route, string Name)> Routes { get; set; } = [];

    protected override void OnInitialized()
    {
        base.OnInitialized();

        try
        {
            var routes = new List<(string Route, string Name)>();

            var assemblies = AppDomain.CurrentDomain.GetAssemblies();
            foreach (var asm in assemblies)
            {
                Type[] types;
                try { types = asm.GetTypes(); } catch { continue; }

                foreach (var t in types)
                {
                    object[] attrs;
                    try { attrs = t.GetCustomAttributes(false); } catch { continue; }


                    foreach (var a in attrs)
                    {
                        var at = a.GetType();
                        if (at.FullName != "Microsoft.AspNetCore.Components.RouteAttribute") continue;

                        var prop = at.GetProperty("Template");
                        var template = prop?.GetValue(a) as string ?? string.Empty;

                        if (string.IsNullOrWhiteSpace(template)) continue;

                        var name = t.Name;
                        routes.Add((template, name));
                    }
                }
            }

            Routes = routes
                .GroupBy(r => r.Route)
                .Select(g => g.First())
                .Where(r => !IsExcludedFromNavigation(r.Route))
                .OrderBy(r => r.Route)
                .ToList();
        }
        catch
        {
            Routes = new List<(string Route, string Name)>();
        }
    }

    private static bool IsExcludedFromNavigation(string route)
    {
        // Exclude individual blog post pages from navigation
        // Keep the blog index page (/blog) but exclude specific posts like /blog/post-001, /blog/sample-post
        if (route.StartsWith("/blog/", StringComparison.OrdinalIgnoreCase))
        {
            // Allow /blog but not /blog/anything
            return route.Length > 6; // "/blog/" is 6 characters
        }
        return false;
    }
}
</div>

